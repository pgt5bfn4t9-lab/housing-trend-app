const startYearSlider = document.querySelector("#start-year");
const startYearLabel = document.querySelector("#start-year-label");
const startPriceEl = document.querySelector("#start-price");
const latestPriceEl = document.querySelector("#latest-price");
const totalChangeEl = document.querySelector("#total-change");
const dataBody = document.querySelector("#data-body");
const chart = document.querySelector("#chart");
const chartPanel = document.querySelector(".chart-panel");
const chartTooltip = document.querySelector("#chart-tooltip");
const rawInput = document.querySelector("#raw-input");
const parseBtn = document.querySelector("#parse-btn");
const bgmBtn = document.querySelector("#bgm-btn");
const bgmVolume = document.querySelector("#bgm-volume");
const parseStatus = document.querySelector("#parse-status");
const saveNameInput = document.querySelector("#save-name");
const saveBtn = document.querySelector("#save-btn");
const savedSelect = document.querySelector("#saved-select");
const deleteBtn = document.querySelector("#delete-btn");
const exportSavedBtn = document.querySelector("#export-saved-btn");
const importSavedBtn = document.querySelector("#import-saved-btn");
const importSavedFile = document.querySelector("#import-saved-file");

const SAVED_KEY = "housingSavedPastesV1";
const DEFAULT_SAVED_NAME = "é¢å¾·å…¬é¦†";
const XIYA_SAVED_NAME = "è¥¿é›…è‹‘";
const PENGRUI_SAVED_NAME = "é¹ç‘žé‡‘çŽ¥æ¹¾";
const NANSHAN_SAVED_NAME = "å—å±±ä¸°æ™¯";
const FULI_DONGDIWAN_SAVED_NAME = "å¯ŒåŠ›ä¸œå ¤æ¹¾";
const XIAOFENGYINYUE_SAVED_NAME = "ç»¿åŸŽæ™“é£Žå°æœˆ";
const YIDE_DATA_TEXT = `æ—¥æœŸ	å•ä»·	é¢ç§¯ï¼ˆãŽ¡ï¼‰	æ€»ä»·	æœå‘	æ¥¼å±‚
æ—¥æœŸ2026.01.22	126123å…ƒ	220.42	2780ä¸‡å…ƒ	å— è¥¿å— åŒ—	ä½Žæ¥¼å±‚(å…±36å±‚)
æ—¥æœŸ2024.11.11	199320å…ƒ	170.58	3400ä¸‡å…ƒ	å— åŒ—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2024.10.12	200978å…ƒ	184.1	3700ä¸‡å…ƒ	å— åŒ—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2023.08.22	244343å…ƒ	170.58	4168ä¸‡å…ƒ	å— åŒ—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2023.04.14	252005å…ƒ	199.6	5030ä¸‡å…ƒ	å—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2023.03.01	236407å…ƒ	219.96	5200ä¸‡å…ƒ	å—	ä½Žæ¥¼å±‚(å…±36å±‚)
æ—¥æœŸ2023.02.22	244990å…ƒ	199.6	4890ä¸‡å…ƒ	å—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2023.01.06	209853å…ƒ	203	4260ä¸‡å…ƒ	å—	ä½Žæ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2022.11.13	199034å…ƒ	207	4120ä¸‡å…ƒ	åŒ—	ä½Žæ¥¼å±‚(å…±42å±‚)
æ—¥æœŸ2022.03.21	217375å…ƒ	199.6	4338.8ä¸‡å…ƒ	å—	ä¸­æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2021.05.16	227460å…ƒ	170.58	3880ä¸‡å…ƒ	å— åŒ—	ä¸­æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2021.03.04	180361å…ƒ	199.6	3600ä¸‡å…ƒ	å— åŒ—	é«˜æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2021.01.15	167353å…ƒ	170	2845ä¸‡å…ƒ	å— åŒ—	ä¸­æ¥¼å±‚(å…±43å±‚)
æ—¥æœŸ2020.08.21	132752å…ƒ	219.96	2920ä¸‡å…ƒ	å—	ä½Žæ¥¼å±‚(å…±36å±‚)
æ—¥æœŸ2020.07.18	110542å…ƒ	173.69	1920ä¸‡å…ƒ	å— åŒ—	ä½Žæ¥¼å±‚(å…±43å±‚)`;
const XIYA_DATA_TEXT = `è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³
åŒ— | ç²¾è£…2025.12.19362.8ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 2002å¹´å¡”æ¥¼39781å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ418ä¸‡æˆäº¤å‘¨æœŸ146å¤©
æ¬§é˜³å®¶å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 2å®¤2åŽ… 94.62å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 2å®¤2åŽ… 94.62å¹³ç±³
å— | å…¶ä»–2025.12.17316ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 1997å¹´æ¿å¡”ç»“åˆ33397å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ399ä¸‡æˆäº¤å‘¨æœŸ971å¤©
å´”æ™“é”‹å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 2å®¤2åŽ… 91.2å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 2å®¤2åŽ… 91.2å¹³ç±³
åŒ— | ç²¾è£…2025.06.09468ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼51316å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ468ä¸‡æˆäº¤å‘¨æœŸ193å¤©
ä½•åŸŽå…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤1åŽ… 88.01å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 88.01å¹³ç±³
å— | å…¶ä»–2025.05.16468ä¸‡
ä¸­æ¥¼å±‚(å…±18å±‚) 1998å¹´å¡”æ¥¼53176å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ468ä¸‡æˆäº¤å‘¨æœŸ41å¤©
ä½•åŸŽå…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤1åŽ… 98.94å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 98.94å¹³ç±³
å— åŒ— | ç®€è£…2025.04.04522ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼52760å…ƒ/å¹³
è¿‘åœ°é“
æŒ‚ç‰Œ565ä¸‡æˆäº¤å‘¨æœŸ380å¤©
æ¢æŸ±é‡‘å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 98.94å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 98.94å¹³ç±³
å— åŒ— | ç²¾è£…2025.03.19556ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼56196å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´è¿‘åœ°é“
æŒ‚ç‰Œ638ä¸‡æˆäº¤å‘¨æœŸ78å¤©
éƒ‘æ€æºå…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³
å— | ç²¾è£…2025.01.24558ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼50857å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ595ä¸‡æˆäº¤å‘¨æœŸ101å¤©
æ½˜æ¡‚æœ±å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 4å®¤2åŽ… 114.86å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 4å®¤2åŽ… 114.86å¹³ç±³
å— | å…¶ä»–2024.10.15650ä¸‡
ä¸­æ¥¼å±‚(å…±18å±‚) 1998å¹´å¡”æ¥¼56591å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ768ä¸‡æˆäº¤å‘¨æœŸ52å¤©
è°¢åŽå»ºå…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 1å®¤0åŽ… 44.2å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 1å®¤0åŽ… 44.2å¹³ç±³
ä¸œå— | å…¶ä»–2024.08.04208ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´æ¿å¡”ç»“åˆ47059å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ240ä¸‡æˆäº¤å‘¨æœŸ57å¤©
é»„äºšå¦®å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³
å— è¥¿å— åŒ— | ç®€è£…2024.06.16558ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼50857å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ650ä¸‡æˆäº¤å‘¨æœŸ118å¤©
å†¯æ´è°Šå…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 104å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 104å¹³ç±³
å— | å…¶ä»–2024.06.11615ä¸‡
é«˜æ¥¼å±‚(å…±18å±‚) 1998å¹´å¡”æ¥¼59135å…ƒ/å¹³
è¿‘åœ°é“
æŒ‚ç‰Œ750ä¸‡æˆäº¤å‘¨æœŸ45å¤©
æˆ´å¿—æ­å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 95.86å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 95.86å¹³ç±³
å— | ç²¾è£…2024.06.08533ä¸‡
é«˜æ¥¼å±‚(å…±18å±‚) 1998å¹´å¡”æ¥¼55602å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ588ä¸‡æˆäº¤å‘¨æœŸ35å¤©
å¼ è‹—å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 89.9å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 89.9å¹³ç±³
å— | ç®€è£…2022.10.10708ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼78755å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ745ä¸‡æˆäº¤å‘¨æœŸ99å¤©
æŽé’°å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 2å®¤2åŽ… 79.19å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 2å®¤2åŽ… 79.19å¹³ç±³
è¥¿åŒ— | ç²¾è£…2022.04.16525ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 1998å¹´æ¿å¡”ç»“åˆ66297å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ549ä¸‡æˆäº¤å‘¨æœŸ88å¤©
æ¢é‡‘è‰³å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 109.72å¹³ç±³
å— | ç®€è£…2021.07.24830ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼75648å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ840ä¸‡æˆäº¤å‘¨æœŸ7å¤©
è®¸å®¶æ°å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³
åŒ— | ç®€è£…2021.05.02660ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼72369å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ715ä¸‡æˆäº¤å‘¨æœŸ11å¤©
å´”æ™“é”‹å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 109å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 109å¹³ç±³
å— | å…¶ä»–2021.01.03733ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 1998å¹´æ¿å¡”ç»“åˆ67248å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ756ä¸‡æˆäº¤å‘¨æœŸ76å¤©
å´”æ™“é”‹å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤1åŽ… 89å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 89å¹³ç±³
å— | å…¶ä»–2020.11.14656ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) å¡”æ¥¼73708å…ƒ/å¹³
è¿‘åœ°é“
æŒ‚ç‰Œ670ä¸‡æˆäº¤å‘¨æœŸ2å¤©
å´”æ™“é”‹å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 109å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 109å¹³ç±³
å— åŒ— | ç®€è£…2020.08.23641ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼58808å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ665ä¸‡æˆäº¤å‘¨æœŸ678å¤©
ä½™æ·¡æ¢…å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤1åŽ… 91.2å¹³ç±³
å— | å…¶ä»–2020.08.23568ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 1998å¹´å¡”æ¥¼62281å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´è¿‘åœ°é“
æŒ‚ç‰Œ600ä¸‡æˆäº¤å‘¨æœŸ91å¤©
ç½—é›ªæ¢…å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 3å®¤2åŽ… 99å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 3å®¤2åŽ… 99å¹³ç±³
ä¸œå— | ç®€è£…2019.09.30600ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 1990å¹´å¡”æ¥¼60607å…ƒ/å¹³
è¿‘åœ°é“
æŒ‚ç‰Œ625ä¸‡æˆäº¤å‘¨æœŸ87å¤©
å´”æ™“é”‹å…è´¹å’¨è¯¢
è¥¿é›…è‹‘ 2å®¤2åŽ… 93å¹³ç±³-å¹¿å·žè¥¿é›…è‹‘äºŒæ‰‹æˆ¿æˆäº¤
è¥¿é›…è‹‘ 2å®¤2åŽ… 93å¹³ç±³
åŒ— | ç®€è£…2018.09.10480ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 1998å¹´æ¿å¡”ç»“åˆ51613å…ƒ/å¹³
æŒ‚ç‰Œ518ä¸‡æˆäº¤å‘¨æœŸ191å¤©
è®¸å®¶æ°å…è´¹å’¨è¯¢`;
const PENGRUI_DATA_TEXT = `é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 143.79å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 143.79å¹³ç±³
ä¸œå— | ç²¾è£…2025.04.02290.8ä¸‡
ä¸­æ¥¼å±‚(å…±26å±‚) æ¿æ¥¼20224å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ320ä¸‡æˆäº¤å‘¨æœŸ30å¤©
æŽå­”ç§‘å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 143.38å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 143.38å¹³ç±³
å— åŒ— | æ¯›å¯2025.02.16270ä¸‡
ä¸­æ¥¼å±‚(å…±6å±‚) æš‚æ— æ•°æ®18832å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ300ä¸‡æˆäº¤å‘¨æœŸ494å¤©
åˆ˜ç»Ÿå…‰å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 128.27å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 128.27å¹³ç±³
å— | å…¶ä»–2025.01.23310ä¸‡
é«˜æ¥¼å±‚(å…±26å±‚) æ¿æ¥¼24168å…ƒ/å¹³
æŒ‚ç‰Œ360ä¸‡æˆäº¤å‘¨æœŸ325å¤©
è‚–æ­¦å¹³å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 128.24å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 128.24å¹³ç±³
å— | å…¶ä»–2024.12.28210ä¸‡
ä½Žæ¥¼å±‚(å…±26å±‚) æ¿æ¥¼16376å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ245ä¸‡æˆäº¤å‘¨æœŸ386å¤©
åˆ˜å¿ èŠ¹å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 99.45å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 99.45å¹³ç±³
ä¸œå— | ç²¾è£…2024.08.31183ä¸‡
ä¸­æ¥¼å±‚(å…±26å±‚) æ¿æ¥¼18402å…ƒ/å¹³
æŒ‚ç‰Œ200ä¸‡æˆäº¤å‘¨æœŸ106å¤©
é»„æž—å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 99.45å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 3å®¤2åŽ… 99.45å¹³ç±³
ä¸œå— | å…¶ä»–2024.06.15190ä¸‡
é«˜æ¥¼å±‚(å…±26å±‚) æ¿æ¥¼19106å…ƒ/å¹³
æŒ‚ç‰Œ199ä¸‡æˆäº¤å‘¨æœŸ279å¤©
é»„ä¸šå‹¤å…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 5å®¤2åŽ… 143.99å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 5å®¤2åŽ… 143.99å¹³ç±³
ä¸œå— | æ¯›å¯2024.04.20496ä¸‡
ä½Žæ¥¼å±‚(å…±6å±‚) æ¿æ¥¼34447å…ƒ/å¹³
æŒ‚ç‰Œ600ä¸‡æˆäº¤å‘¨æœŸ57å¤©
éƒ‘å¦®åŽå…è´¹å’¨è¯¢
é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 193å¹³ç±³-ç æµ·é¹ç‘žé‡‘çŽ¥æ¹¾äºŒæ‰‹æˆ¿æˆäº¤
é¹ç‘žé‡‘çŽ¥æ¹¾ 4å®¤2åŽ… 193å¹³ç±³
ä¸œå— | ç²¾è£…2024.02.27458ä¸‡
ä½Žæ¥¼å±‚(å…±26å±‚) æ¿æ¥¼23731å…ƒ/å¹³
æŒ‚ç‰Œ470ä¸‡æˆäº¤å‘¨æœŸ82å¤©
æ¨è±ªæ°`;
const NANSHAN_DATA_TEXT = `å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.14å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.14å¹³ç±³
å— | ç®€è£…2021.08.08141ä¸‡
ä½Žæ¥¼å±‚(å…±29å±‚) 2017å¹´æ¿æ¥¼13285å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ142ä¸‡æˆäº¤å‘¨æœŸ132å¤©
è´ºæ¡‚çŽ‰å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³
å— | ç²¾è£…2021.07.2181.8ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12357å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ82ä¸‡æˆäº¤å‘¨æœŸ13å¤©
éƒ­ç‡•å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 81.65å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 81.65å¹³ç±³
å— | ç²¾è£…2021.07.15100ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´æ¿æ¥¼12248å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ101ä¸‡æˆäº¤å‘¨æœŸ50å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.28å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.28å¹³ç±³
å— | ç²¾è£…2021.07.10132ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 2017å¹´å¡”æ¥¼12421å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ137ä¸‡æˆäº¤å‘¨æœŸ109å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 4å®¤2åŽ… 141.52å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 4å®¤2åŽ… 141.52å¹³ç±³
å— | ç®€è£…2021.06.20183ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®12932å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ190ä¸‡æˆäº¤å‘¨æœŸ60å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62å¹³ç±³
åŒ— | ç²¾è£…2021.05.2388ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®14194å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ90ä¸‡æˆäº¤å‘¨æœŸ46å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 61.97å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 61.97å¹³ç±³
åŒ— | å…¶ä»–2021.05.1686.8ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®14007å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ90ä¸‡æˆäº¤å‘¨æœŸ5å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 84.45å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 84.45å¹³ç±³
å— | ç²¾è£…2021.05.1099ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 2017å¹´å¡”æ¥¼11723å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ103ä¸‡æˆäº¤å‘¨æœŸ33å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 83.9å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 83.9å¹³ç±³
å— | ç²¾è£…2021.03.24112.5ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) 2017å¹´å¡”æ¥¼13409å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ117ä¸‡æˆäº¤å‘¨æœŸ13å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 117.74å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 117.74å¹³ç±³
å— | å…¶ä»–2021.02.27160ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®13590å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ162ä¸‡æˆäº¤å‘¨æœŸ49å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.28å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 106.28å¹³ç±³
å— åŒ— | ç²¾è£…2021.02.20142.5ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 2017å¹´å¡”æ¥¼13408å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ145ä¸‡æˆäº¤å‘¨æœŸ55å¤©
æ­ç‡•å¨‡å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³
å— | ç²¾è£…2021.02.2084ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12689å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ85ä¸‡æˆäº¤å‘¨æœŸ29å¤©
å­™å…ƒä¹¾å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 84.54å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 84.54å¹³ç±³
å— | ç²¾è£…2021.02.07105ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´å¡”æ¥¼12421å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ108ä¸‡æˆäº¤å‘¨æœŸ9å¤©
éƒ­ç‡•å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.65å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.65å¹³ç±³
å— åŒ— | ç®€è£…2021.01.23103ä¸‡
ä½Žæ¥¼å±‚(å…±29å±‚) 2017å¹´æ¿æ¥¼12615å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ108ä¸‡æˆäº¤å‘¨æœŸ61å¤©
éƒ‘å°å¦¹å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 63å¹³ç±³
å— | å…¶ä»–2021.01.1884ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®13334å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ86ä¸‡æˆäº¤å‘¨æœŸ2å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.16å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.16å¹³ç±³
ä¸œ å— | ç²¾è£…2021.01.1881.5ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12319å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ88ä¸‡æˆäº¤å‘¨æœŸ21å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.86å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.86å¹³ç±³
å— | ç²¾è£…2021.01.0483ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12414å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ85ä¸‡æˆäº¤å‘¨æœŸ13å¤©
å¢é›ç›ˆå…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 84.45å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 84.45å¹³ç±³
å— åŒ— | ç®€è£…2020.12.3096ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 2017å¹´å¡”æ¥¼11368å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ103ä¸‡æˆäº¤å‘¨æœŸ32å¤©
å‘¨ç§€ç¼å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³
å— | å…¶ä»–2020.11.2682ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12387å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ87ä¸‡æˆäº¤å‘¨æœŸ53å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62å¹³ç±³
åŒ— | å…¶ä»–2020.06.1978ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12581å…ƒ/å¹³
æŒ‚ç‰Œ78ä¸‡æˆäº¤å‘¨æœŸ2å¤©
åº„ç››è‰ºå…è´¹å’¨è¯¢

å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62.04å¹³ç±³
åŒ— | ç²¾è£…2026.01.2436.5ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®5884å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ40ä¸‡æˆäº¤å‘¨æœŸ20å¤©
çŽ‹æ™“æ˜Žå…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.16å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.16å¹³ç±³
å— | ç®€è£…2025.12.3038.8ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®5865å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ44.8ä¸‡æˆäº¤å‘¨æœŸ10å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 83.96å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 83.96å¹³ç±³
å— | ç®€è£…2025.12.2039ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´å¡”æ¥¼4646å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ46.5ä¸‡æˆäº¤å‘¨æœŸ122å¤©
å‘¨åˆ©åˆ©å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 61.97å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 61.97å¹³ç±³
åŒ— | ç²¾è£…2025.11.0538.6ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) æš‚æ— æ•°æ®6229å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ43.8ä¸‡æˆäº¤å‘¨æœŸ64å¤©
é™ˆæ€¡ç³å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 62å¹³ç±³
ä¸œåŒ— | ç²¾è£…2025.10.2439.3ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®6339å…ƒ/å¹³
æŒ‚ç‰Œ45ä¸‡æˆäº¤å‘¨æœŸ20å¤©
å¼ æˆ¿å¤å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 62.04å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 62.04å¹³ç±³
åŒ— | ç®€è£…2025.10.1335ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®5642å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ46ä¸‡æˆäº¤å‘¨æœŸ16å¤©
çŽ‹å†¬æ¢…å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 4å®¤1åŽ… 140.01å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 4å®¤1åŽ… 140.01å¹³ç±³
å— | ç²¾è£…2025.05.2693.5ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) æš‚æ— æ•°æ®6679å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ106ä¸‡æˆäº¤å‘¨æœŸ253å¤©
éƒ‘æ±Ÿçº¢å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³
å— åŒ— | å…¶ä»–2025.04.1146.2ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®6979å…ƒ/å¹³
æŒ‚ç‰Œ48ä¸‡æˆäº¤å‘¨æœŸ36å¤©
é™ˆæ€¡ç³å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.24å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.24å¹³ç±³
ä¸œå— å— | ç²¾è£…2025.03.2046.8ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®7066å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ50ä¸‡æˆäº¤å‘¨æœŸ68å¤©
æ›¹é‡‘èŠ±å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 63.03å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 63.03å¹³ç±³
å— | ç²¾è£…2025.02.2843.8ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®6950å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ50ä¸‡æˆäº¤å‘¨æœŸ4å¤©
é™ˆæ€¡ç³å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤1åŽ… 106.1å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤1åŽ… 106.1å¹³ç±³
å— åŒ— | å…¶ä»–2024.11.0274.5ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´æš‚æ— æ•°æ®7022å…ƒ/å¹³
æŒ‚ç‰Œ89ä¸‡æˆäº¤å‘¨æœŸ1å¤©
å¾æ–‡å©·å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.9å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.9å¹³ç±³
å— | ç²¾è£…2024.08.0846.6ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®6966å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ55ä¸‡æˆäº¤å‘¨æœŸ24å¤©
éƒ‘æ±Ÿçº¢å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.2å¹³ç±³
å— | å…¶ä»–2024.07.0850.5ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®7629å…ƒ/å¹³
æŒ‚ç‰Œ57ä¸‡æˆäº¤å‘¨æœŸ4å¤©
é™ˆæ ‘äº‘å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 4å®¤2åŽ… 140å¹³ç±³
è¥¿å— | å…¶ä»–2024.05.22103ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®7358å…ƒ/å¹³
æŒ‚ç‰Œ135ä¸‡æˆäº¤å‘¨æœŸ3å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³
å— | ç²¾è£…2024.05.0451.2ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®7735å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ56ä¸‡æˆäº¤å‘¨æœŸ63å¤©
éƒ‘æ±Ÿçº¢å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 117.68å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 117.68å¹³ç±³
å— | ç²¾è£…2024.03.2688.8ä¸‡
é«˜æ¥¼å±‚(å…±28å±‚) æš‚æ— æ•°æ®7546å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ95ä¸‡æˆäº¤å‘¨æœŸ21å¤©
éƒ‘æ±Ÿçº¢å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 4å®¤1åŽ… 139.43å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 4å®¤1åŽ… 139.43å¹³ç±³
å— | å…¶ä»–2023.12.14112ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®8033å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ125ä¸‡æˆäº¤å‘¨æœŸ10å¤©
å¶å¿—è¾‰å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 4å®¤2åŽ… 140.64å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 4å®¤2åŽ… 140.64å¹³ç±³
å— | ç²¾è£…2023.11.23118ä¸‡
ä¸­æ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®8391å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ126ä¸‡æˆäº¤å‘¨æœŸ7å¤©
å”å…‰å“å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.86å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.86å¹³ç±³
å— | ç²¾è£…2023.11.2060ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®8974å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ60ä¸‡æˆäº¤å‘¨æœŸ2å¤©
æ¸©ä¼Ÿæ°å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 83.96å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 83.96å¹³ç±³
å— | ç²¾è£…2023.05.2178ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) 2017å¹´å¡”æ¥¼9291å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ85ä¸‡æˆäº¤å‘¨æœŸ84å¤©
å‘¨ç§€ç¼å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 103.17å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 103.17å¹³ç±³
ä¸œå— | ç®€è£…2023.05.04112ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) 2017å¹´æš‚æ— æ•°æ®10856å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ115ä¸‡æˆäº¤å‘¨æœŸ35å¤©
é™ˆæ ‘äº‘å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66å¹³ç±³
å— | ç®€è£…2023.03.3063ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®9546å…ƒ/å¹³
æŒ‚ç‰Œ65ä¸‡æˆäº¤å‘¨æœŸ22å¤©
é™ˆæ ‘äº‘å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.9å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.9å¹³ç±³
å— | å…¶ä»–2023.03.2571ä¸‡
ä½Žæ¥¼å±‚(å…±29å±‚) æš‚æ— æ•°æ®10613å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ75ä¸‡æˆäº¤å‘¨æœŸ26å¤©
å€ªè£çŠå…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 61.97å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 61.97å¹³ç±³
åŒ— | ç®€è£…2023.03.1162ä¸‡
é«˜æ¥¼å±‚(å…±31å±‚) æš‚æ— æ•°æ®10005å…ƒ/å¹³
æŒ‚ç‰Œ63ä¸‡æˆäº¤å‘¨æœŸ12å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 103.17å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 103.17å¹³ç±³
å— | ç²¾è£…2022.12.05114.8ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´æš‚æ— æ•°æ®11128å…ƒ/å¹³
æˆ¿å±‹æ»¡ä¸¤å¹´
æŒ‚ç‰Œ115ä¸‡æˆäº¤å‘¨æœŸ15å¤©
é™ˆæ ‘äº‘å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 121.33å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 3å®¤2åŽ… 121.33å¹³ç±³
å— | ç²¾è£…2022.09.04151ä¸‡
ä½Žæ¥¼å±‚(å…±28å±‚) 2017å¹´æš‚æ— æ•°æ®12446å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ158ä¸‡æˆäº¤å‘¨æœŸ175å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.65å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.65å¹³ç±³
å— åŒ— | ç®€è£…2022.08.2895ä¸‡
ä¸­æ¥¼å±‚(å…±29å±‚) 2017å¹´æ¿æ¥¼11636å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ100ä¸‡æˆäº¤å‘¨æœŸ35å¤©
é™ˆæ ‘äº‘å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.16å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤1åŽ… 66.16å¹³ç±³
å— | ç²¾è£…2022.01.0184.5ä¸‡
ä½Žæ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®12773å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ88ä¸‡æˆäº¤å‘¨æœŸ10å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 66.2å¹³ç±³
å— | ç²¾è£…2021.10.2090ä¸‡
ä¸­æ¥¼å±‚(å…±31å±‚) 2017å¹´æš‚æ— æ•°æ®13596å…ƒ/å¹³
æˆ¿å±‹æ»¡äº”å¹´
æŒ‚ç‰Œ92.5ä¸‡æˆäº¤å‘¨æœŸ12å¤©
æ²™æµ·æž—å…è´¹å’¨è¯¢
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.76å¹³ç±³-å¹¿å·žå—å±±ä¸°æ™¯äºŒæ‰‹æˆ¿æˆäº¤
å—å±±ä¸°æ™¯ 2å®¤2åŽ… 81.76å¹³ç±³
å— | ç²¾è£…2021.08.19101ä¸‡
é«˜æ¥¼å±‚(å…±29å±‚) 2017å¹´å¡”æ¥¼12354å…ƒ/å¹³
æŒ‚ç‰Œ104.5ä¸‡æˆäº¤å‘¨æœŸ17å¤©
é™ˆå®¶ç†™`;
const FULI_DONGDIWAN_DATA_TEXT = `æ—¥æœŸ	å•ä»·	é¢ç§¯ï¼ˆãŽ¡ï¼‰	æ€»ä»·	æœå‘	æ¥¼å±‚
2025.12.01	78521	117.74	924.5	å—	é«˜æ¥¼å±‚
2025.11.24	66328	84.43	560	å— è¥¿	ä½Žæ¥¼å±‚
2025.10.07	70629	82.12	580	è¥¿å—	ä¸­æ¥¼å±‚
2025.05.01	80815	119.78	968	è¥¿å—	é«˜æ¥¼å±‚
2025.03.23	79173	44.46	352	ä¸œåŒ—	é«˜æ¥¼å±‚
2025.03.18	73457	81	595	è¥¿åŒ—	ä¸­æ¥¼å±‚
2025.03.11	79282	116.42	923	ä¸œ ä¸œå—	ä¸­æ¥¼å±‚
2025.03.01	74225	44.46	330	è¥¿å—	ä½Žæ¥¼å±‚
2024.12.23	80656	97.7	788	ä¸œ è¥¿ è¥¿å—	ä¸­æ¥¼å±‚
2024.11.19	69889	84.42	590	åŒ—	é«˜æ¥¼å±‚
2024.11.13	71224	83.54	595	è¥¿åŒ—	ä¸­æ¥¼å±‚
2024.11.05	71812	82.16	590	è¥¿å—	ä½Žæ¥¼å±‚
2024.10.29	79822	139.06	1110	ä¸œå—	ä½Žæ¥¼å±‚
2024.10.26	74500	117.45	875	ä¸œå—	ä½Žæ¥¼å±‚
2024.10.23	71352	121.09	864	è¥¿åŒ—	ä½Žæ¥¼å±‚
2024.10.15	78625	115.74	910	è¥¿åŒ—	é«˜æ¥¼å±‚
2024.10.13	76059	115.7	880	è¥¿å—	ä¸­æ¥¼å±‚
2024.10.11	67784	125.4	850	ä¸œåŒ—	é«˜æ¥¼å±‚
2024.10.02	75922	95.23	723	å—	ä¸­æ¥¼å±‚
2024.10.01	79126	119.81	948	è¥¿å—	é«˜æ¥¼å±‚
2024.09.02	71777	82.2	590	è¥¿	ä¸­æ¥¼å±‚
2024.09.01	70488	82	578	å— è¥¿å—	é«˜æ¥¼å±‚
2024.07.19	72451	81.09	587.5	è¥¿	ä¸­æ¥¼å±‚
2024.07.14	66610	70.56	470	ä¸œå—	ä¸­æ¥¼å±‚
2024.07.02	77123	119.42	921	è¥¿å— å—	ä½Žæ¥¼å±‚
2024.06.18	68323	83.72	572	è¥¿	ä½Žæ¥¼å±‚
2024.06.01	69734	81.74	570	è¥¿åŒ—	é«˜æ¥¼å±‚
2024.05.19	68231	83.54	570	åŒ—	ä¸­æ¥¼å±‚
2024.03.12	86617	117.76	1020	ä¸œå—	ä¸­æ¥¼å±‚
2024.03.12	78544	82.12	645	è¥¿ å—	ä¸­æ¥¼å±‚
2023.12.30	86851	81.75	710	è¥¿å—	é«˜æ¥¼å±‚
2023.12.15	83763	85.36	715	ä¸œå—	ä½Žæ¥¼å±‚
2023.12.05	89763	99.15	890	ä¸œå— è¥¿åŒ—	é«˜æ¥¼å±‚
2023.11.03	94048	100.8	948	è¥¿å—	ä¸­æ¥¼å±‚
2023.10.12	104001	116.42	1210.8	ä¸œå—	é«˜æ¥¼å±‚
2023.06.19	100299	46.96	471	è¥¿	é«˜æ¥¼å±‚
2023.05.03	105191	80.14	843	ä¸œå— è¥¿å—	é«˜æ¥¼å±‚
2023.03.22	105929	119.42	1265	è¥¿å—	ä½Žæ¥¼å±‚
2023.02.11	101086	121.58	1229	ä¸œåŒ—	ä½Žæ¥¼å±‚
2023.02.10	103035	119.96	1236	ä¸œå—	ä½Žæ¥¼å±‚
2023.02.08	103244	82	846.6	ä¸œå—	ä½Žæ¥¼å±‚
2023.01.18	97115	122.33	1188	ä¸œå—	é«˜æ¥¼å±‚
2022.12.11	96011	120.82	1160	åŒ— ä¸œåŒ—	ä¸­æ¥¼å±‚
2022.11.18	102977	100.8	1038	ä¸œ è¥¿	é«˜æ¥¼å±‚
2022.10.13	99570	120.82	1203	è¥¿åŒ—	ä¸­æ¥¼å±‚
2022.09.27	102169	83	848	ä¸œåŒ—	é«˜æ¥¼å±‚
2022.08.27	112540	119.78	1348	è¥¿å—	ä¸­æ¥¼å±‚
2022.08.22	103785	119.96	1245	ä¸œå—	ä¸­æ¥¼å±‚
2022.04.28	108600	78.73	855	ä¸œ	é«˜æ¥¼å±‚
2022.02.28	105714	44.46	470	è¥¿å—	é«˜æ¥¼å±‚
2022.02.26	108413	122.68	1330	ä¸œå— å— è¥¿å—	ä½Žæ¥¼å±‚
2021.10.15	115108	139	1600	ä¸œå— å—	é«˜æ¥¼å±‚
2021.10.07	102288	82.61	845	ä¸œåŒ—	ä¸­æ¥¼å±‚
2021.08.27	113560	82.6	938	ä¸œå—	é«˜æ¥¼å±‚
2021.07.12	104672	80.06	838	è¥¿å—	ä½Žæ¥¼å±‚
2021.05.11	105758	80.94	856	è¥¿å—	ä¸­æ¥¼å±‚
2021.05.06	106637	67.05	715	è¥¿å—	ä¸­æ¥¼å±‚
2021.02.21	94891	82.2	780	è¥¿åŒ—	é«˜æ¥¼å±‚
2021.01.07	99021	46.96	465	å—	ä½Žæ¥¼å±‚
2021.01.05	108781	115.83	1260	ä¸œ è¥¿ åŒ—	ä¸­æ¥¼å±‚
2020.12.23	97225	117.46	1142	ä¸œå—	ä½Žæ¥¼å±‚
2020.11.09	94509	95.23	900	å—	ä¸­æ¥¼å±‚
2020.10.31	102934	129.21	1330	ä¸œå—	ä¸­æ¥¼å±‚
2020.10.25	80636	84.33	680	ä¸œ è¥¿åŒ—	ä¸­æ¥¼å±‚
2020.10.06	82200	70.56	580	å—	ä¸­æ¥¼å±‚
2020.08.04	89656	116	1040	å—	ä½Žæ¥¼å±‚
2020.06.21	82349	75.29	620	è¥¿å—	é«˜æ¥¼å±‚
2020.05.13	74405	70.56	525	ä¸œå—	ä¸­æ¥¼å±‚
2019.11.17	67115	67.05	450	è¥¿å—	ä½Žæ¥¼å±‚
2019.08.15	78655	81.75	643	è¥¿å—	ä¸­æ¥¼å±‚
2019.06.24	69405	84	583	åŒ—	ä¸­æ¥¼å±‚
2019.05.25	71588	81.02	580	è¥¿åŒ—	é«˜æ¥¼å±‚
2019.05.01	69151	70.86	490	è¥¿åŒ—	é«˜æ¥¼å±‚
2019.04.30	76875	80	615	è¥¿å—	é«˜æ¥¼å±‚
2019.04.05	74330	82	609.5	è¥¿å—	é«˜æ¥¼å±‚`;
const XIAOFENGYINYUE_DATA_TEXT = `æ—¥æœŸ	å•ä»·	é¢ç§¯ï¼ˆãŽ¡ï¼‰	æ€»ä»·	æœå‘	æ¥¼å±‚
2025.12.01	17894	100.82	180.4	å—	é«˜æ¥¼å±‚
2025.10.26	22775	129.53	295	å— åŒ—	é«˜æ¥¼å±‚
2025.07.09	22858	175	400	å— åŒ—	ä½Žæ¥¼å±‚
2025.04.20	23161	129.53	300	å—	ä½Žæ¥¼å±‚`;

let parsedData = [];
let activePointIndex = -1;
let coasterFrameId = null;
let coasterDistance = 0;
let activeFireworks = [];
const BGM_SRC = "./assets/montagem-miau.mp3";
let bgmAudio = null;
let bgmIsPlaying = false;
const IS_SAFARI = /^((?!chrome|android|crios|fxios|edgios).)*safari/i.test(
  navigator.userAgent || "",
);

init();

function init() {
  ensureSavedItem(DEFAULT_SAVED_NAME, YIDE_DATA_TEXT);
  ensureSavedItem(XIYA_SAVED_NAME, XIYA_DATA_TEXT);
  ensureSavedItem(PENGRUI_SAVED_NAME, PENGRUI_DATA_TEXT);
  ensureSavedItem(NANSHAN_SAVED_NAME, NANSHAN_DATA_TEXT);
  ensureSavedItem(FULI_DONGDIWAN_SAVED_NAME, FULI_DONGDIWAN_DATA_TEXT);
  ensureSavedItem(XIAOFENGYINYUE_SAVED_NAME, XIAOFENGYINYUE_DATA_TEXT);
  if (parseBtn) parseBtn.addEventListener("click", onParse);
  if (bgmBtn) bgmBtn.addEventListener("click", toggleBgm);
  if (bgmVolume) bgmVolume.addEventListener("input", onBgmVolumeChange);
  if (saveBtn) saveBtn.addEventListener("click", saveCurrentPaste);
  if (savedSelect) savedSelect.addEventListener("change", loadSelectedPaste);
  if (deleteBtn) deleteBtn.addEventListener("click", deleteSelectedPaste);
  if (exportSavedBtn) exportSavedBtn.addEventListener("click", exportSavedData);
  if (importSavedBtn) importSavedBtn.addEventListener("click", openImportPicker);
  if (importSavedFile) importSavedFile.addEventListener("change", importSavedData);
  if (startYearSlider) startYearSlider.addEventListener("input", render);
  renderSavedOptions();
  loadDefaultSavedData();
  initBgm();
}

function openImportPicker() {
  if (!importSavedFile) return;
  parseStatus.classList.remove("error");
  parseStatus.textContent = "è¯·åœ¨å¼¹çª—ä¸­é€‰æ‹© JSON æ–‡ä»¶ã€‚";
  if (typeof importSavedFile.showPicker === "function") {
    importSavedFile.showPicker();
    return;
  }
  importSavedFile.click();
}

function initBgm() {
  bgmAudio = new Audio(BGM_SRC);
  bgmAudio.loop = true;
  bgmAudio.preload = "auto";
  onBgmVolumeChange();
  tryAutoPlayBgm();
}

async function tryAutoPlayBgm() {
  if (!bgmAudio) return;
  try {
    await bgmAudio.play();
    setBgmPlayingUI(true);
  } catch {
    setBgmPlayingUI(false);
    parseStatus.classList.remove("error");
    parseStatus.textContent = "è‡ªåŠ¨æ’­æ”¾è¢«æµè§ˆå™¨é™åˆ¶ï¼Œè¯·ç‚¹å‡»â€œæ’­æ”¾BGMâ€ã€‚";
  }
}

async function toggleBgm() {
  if (!bgmAudio) return;
  if (!bgmIsPlaying) {
    try {
      await bgmAudio.play();
      setBgmPlayingUI(true);
    } catch {
      parseStatus.classList.add("error");
      parseStatus.textContent = "BGMæ’­æ”¾å¤±è´¥ï¼Œè¯·ç¡®è®¤ ./assets/montagem-miau.mp3 æ–‡ä»¶å­˜åœ¨ã€‚";
    }
  } else {
    bgmAudio.pause();
    setBgmPlayingUI(false);
  }
}

function setBgmPlayingUI(playing) {
  bgmIsPlaying = playing;
  bgmBtn.textContent = playing ? "æš‚åœBGM" : "æ’­æ”¾BGM";
  bgmBtn.classList.toggle("playing", playing);
}

function onBgmVolumeChange() {
  if (!bgmAudio) return;
  const value = Number(bgmVolume.value) / 100;
  bgmAudio.volume = Math.max(0, Math.min(1, value));
}

function loadDefaultSavedData() {
  const preferred = getSavedItems().find((item) => item.name === DEFAULT_SAVED_NAME);
  if (preferred) {
    if (savedSelect) savedSelect.value = preferred.id;
    rawInput.value = preferred.rawText;
    saveNameInput.value = preferred.name;
    onParse();
    parseStatus.classList.remove("error");
    parseStatus.textContent = `å·²åŠ è½½ä¿å­˜æ•°æ®â€œ${preferred.name}â€ã€‚`;
    return;
  }

  const demoText = YIDE_DATA_TEXT;
  upsertSavedItem(DEFAULT_SAVED_NAME, demoText);
  renderSavedOptions();
  const saved = getSavedItems().find((item) => item.name === DEFAULT_SAVED_NAME);
  if (saved) savedSelect.value = saved.id;
  rawInput.value = demoText;
  saveNameInput.value = DEFAULT_SAVED_NAME;
  onParse();
  parseStatus.classList.remove("error");
  parseStatus.textContent = `å·²å°†ç¤ºä¾‹æ•°æ®å†™å…¥ä¿å­˜åç§°â€œ${DEFAULT_SAVED_NAME}â€ã€‚`;
}

function upsertSavedItem(name, rawText) {
  const items = getSavedItems();
  const existing = items.find((x) => x.name === name);
  const now = Date.now();

  if (existing) {
    existing.rawText = rawText;
    existing.updatedAt = now;
  } else {
    items.push({
      id: `${now}-${Math.random().toString(36).slice(2, 7)}`,
      name,
      rawText,
      updatedAt: now,
    });
  }
  setSavedItems(items);
}

function ensureSavedItem(name, rawText) {
  const items = getSavedItems();
  const existing = items.find((x) => x.name === name);
  if (!existing || existing.rawText !== rawText) {
    upsertSavedItem(name, rawText);
  }
}

function onParse() {
  const rows = extractDatePriceRows(rawInput.value);
  if (rows.length < 2) {
    parseStatus.textContent = "è§£æžåˆ°çš„æ•°æ®ä¸è¶³ã€‚è¯·ç¡®è®¤æ–‡æœ¬ä¸­åŒ…å«æ—¥æœŸå’Œâ€œå…ƒ/å¹³â€ã€‚";
    parseStatus.classList.add("error");
    return;
  }

  parseStatus.classList.remove("error");
  parseStatus.textContent = `å·²ä»Žç²˜è´´å†…å®¹ä¸­è§£æžå‡º ${rows.length} æ¡è®°å½•ã€‚`;

  parsedData = rows.sort((a, b) => a.date.localeCompare(b.date));

  const years = parsedData.map((d) => Number(d.date.slice(0, 4)));
  const minYear = Math.min(...years);
  const maxYear = Math.max(...years);
  startYearSlider.min = String(minYear);
  startYearSlider.max = String(maxYear);
  startYearSlider.value = String(minYear);

  render();
}

function getSavedItems() {
  let raw = null;
  try {
    raw = localStorage.getItem(SAVED_KEY);
  } catch {
    return [];
  }
  if (!raw) return [];
  try {
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  } catch {
    return [];
  }
}

function setSavedItems(items) {
  try {
    localStorage.setItem(SAVED_KEY, JSON.stringify(items));
  } catch {
    parseStatus.textContent = "æµè§ˆå™¨å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œå·²è·³è¿‡ä¿å­˜ã€‚";
    parseStatus.classList.add("error");
  }
}

function renderSavedOptions() {
  const items = getSavedItems();
  savedSelect.innerHTML = "";

  if (!items.length) {
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "æš‚æ— å·²ä¿å­˜æ•°æ®";
    savedSelect.append(opt);
    savedSelect.disabled = true;
    deleteBtn.disabled = true;
    return;
  }

  savedSelect.disabled = false;
  deleteBtn.disabled = false;

  items
    .sort((a, b) => b.updatedAt - a.updatedAt)
    .forEach((item) => {
      const opt = document.createElement("option");
      opt.value = item.id;
      opt.textContent = item.name;
      savedSelect.append(opt);
    });
}

function saveCurrentPaste() {
  const name = saveNameInput.value.trim();
  const text = rawInput.value.trim();

  if (!name) {
    parseStatus.textContent = "è¯·å…ˆè¾“å…¥ä¿å­˜åç§°ã€‚";
    parseStatus.classList.add("error");
    return;
  }
  if (!text) {
    parseStatus.textContent = "è¯·å…ˆç²˜è´´å†…å®¹ï¼Œå†è¿›è¡Œä¿å­˜ã€‚";
    parseStatus.classList.add("error");
    return;
  }

  const items = getSavedItems();
  const existing = items.find((x) => x.name === name);
  const now = Date.now();

  if (existing) {
    existing.rawText = text;
    existing.updatedAt = now;
  } else {
    items.push({
      id: `${now}-${Math.random().toString(36).slice(2, 7)}`,
      name,
      rawText: text,
      updatedAt: now,
    });
  }

  setSavedItems(items);
  renderSavedOptions();
  savedSelect.value = existing ? existing.id : items[items.length - 1].id;
  parseStatus.classList.remove("error");
  parseStatus.textContent = `å·²ä¿å­˜â€œ${name}â€ã€‚`;
}

function loadSelectedPaste() {
  const id = savedSelect.value;
  if (!id) return;
  const item = getSavedItems().find((x) => x.id === id);
  if (!item) return;

  rawInput.value = item.rawText;
  saveNameInput.value = item.name;
  onParse();
  parseStatus.classList.remove("error");
  parseStatus.textContent = `å·²åŠ è½½â€œ${item.name}â€ã€‚`;
}

function deleteSelectedPaste() {
  const id = savedSelect.value;
  if (!id) return;
  const items = getSavedItems();
  const target = items.find((x) => x.id === id);
  const next = items.filter((x) => x.id !== id);
  setSavedItems(next);
  renderSavedOptions();
  parseStatus.classList.remove("error");
  parseStatus.textContent = target ? `å·²åˆ é™¤â€œ${target.name}â€ã€‚` : "å·²åˆ é™¤æ‰€é€‰æ•°æ®ã€‚";
}

function exportSavedData() {
  const items = getSavedItems();
  if (!items.length) {
    parseStatus.classList.add("error");
    parseStatus.textContent = "å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„å°åŒºæ•°æ®ã€‚";
    return;
  }

  const payload = {
    version: 1,
    exportedAt: new Date().toISOString(),
    items: items.map((item) => ({
      name: item.name,
      rawText: item.rawText,
      updatedAt: item.updatedAt || Date.now(),
    })),
  };

  const jsonText = JSON.stringify(payload, null, 2);
  const stamp = new Date().toISOString().slice(0, 10).replace(/-/g, "");
  const fileName = `housing-saved-${stamp}.json`;

  if (IS_SAFARI) {
    const dataUrl = `data:application/json;charset=utf-8,${encodeURIComponent(jsonText)}`;
    const popup = window.open(dataUrl, "_blank");
    if (!popup) {
      window.location.href = dataUrl;
    }
    parseStatus.classList.remove("error");
    parseStatus.textContent = `Safari å·²æ‰“å¼€å¯¼å‡ºå†…å®¹ï¼ˆ${items.length} ä¸ªå°åŒºï¼‰ï¼Œè¯·åœ¨æ–°é¡µé¢ä¿å­˜ä¸º ${fileName}ã€‚`;
    return;
  }

  const blob = new Blob([jsonText], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = fileName;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(() => URL.revokeObjectURL(url), 0);

  parseStatus.classList.remove("error");
  parseStatus.textContent = `å·²å¯¼å‡º ${items.length} ä¸ªå°åŒºæ•°æ®ã€‚`;
}

async function importSavedData(event) {
  const file = event.target.files && event.target.files[0];
  if (!file) return;

  try {
    const text = await readFileText(file);
    const parsed = JSON.parse(text);
    const importedItems = Array.isArray(parsed) ? parsed : parsed.items;
    if (!Array.isArray(importedItems)) {
      throw new Error("bad-format");
    }

    const cleaned = importedItems
      .filter((x) => x && typeof x.name === "string" && typeof x.rawText === "string")
      .map((x) => ({
        name: x.name.trim(),
        rawText: x.rawText,
        updatedAt: Number(x.updatedAt) || Date.now(),
      }))
      .filter((x) => x.name && x.rawText);

    if (!cleaned.length) {
      throw new Error("empty");
    }

    const now = Date.now();
    const byName = new Map(getSavedItems().map((x) => [x.name, x]));
    cleaned.forEach((item, idx) => {
      const existing = byName.get(item.name);
      if (existing) {
        existing.rawText = item.rawText;
        existing.updatedAt = now + idx;
      } else {
        byName.set(item.name, {
          id: `${now + idx}-${Math.random().toString(36).slice(2, 7)}`,
          name: item.name,
          rawText: item.rawText,
          updatedAt: now + idx,
        });
      }
    });

    setSavedItems([...byName.values()]);
    renderSavedOptions();

    const firstImportedName = cleaned[0].name;
    const selected = getSavedItems().find((x) => x.name === firstImportedName);
    if (selected) {
      savedSelect.value = selected.id;
      loadSelectedPaste();
    }

    parseStatus.classList.remove("error");
    parseStatus.textContent = `å·²å¯¼å…¥ ${cleaned.length} ä¸ªå°åŒºæ•°æ®ã€‚`;
  } catch {
    parseStatus.classList.add("error");
    parseStatus.textContent = "å¯¼å…¥å¤±è´¥ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„ JSON æ–‡ä»¶ã€‚";
  } finally {
    importSavedFile.value = "";
  }
}

function readFileText(file) {
  if (typeof file.text === "function") {
    return file.text();
  }
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(String(reader.result || ""));
    reader.onerror = () => reject(new Error("read-failed"));
    reader.readAsText(file, "utf-8");
  });
}

function extractDatePriceRows(text) {
  const tabularRows = extractTabularRows(text);
  if (tabularRows.length) return tabularRows;

  const dateRegex = /(\d{4})[.\/-å¹´](\d{1,2})(?:[.\/-æœˆ](\d{1,2}))?/g;
  const unitPriceRegex = /(\d{4,7}(?:\.\d+)?)\s*å…ƒ(?:\s*[\/ï¼]\s*(?:å¹³|å¹³ç±³|ãŽ¡|mÂ²))?/;

  const dates = Array.from(text.matchAll(dateRegex)).map((m) => ({
    index: m.index,
    year: Number(m[1]),
    month: Number(m[2]),
    day: m[3] ? Number(m[3]) : 1,
  }));

  if (!dates.length) return [];

  const out = [];

  for (let i = 0; i < dates.length; i += 1) {
    const d = dates[i];
    const nextDate = dates[i + 1];
    const blockEnd = nextDate ? nextDate.index : text.length;
    const block = text.slice(d.index, blockEnd);
    if (isParkingRecord(block)) continue;
    const unitPriceMatch = block.match(unitPriceRegex);
    if (!unitPriceMatch) continue;

    const y = String(d.year).padStart(4, "0");
    const m = String(d.month).padStart(2, "0");
    const day = String(d.day).padStart(2, "0");
    const details = extractHouseDetails(block, d);

    out.push({
      date: `${y}-${m}-${day}`,
      price: Number(unitPriceMatch[1]),
      area: details.area,
      totalPrice: details.totalPrice,
      direction: details.direction,
      floor: details.floor,
    });
  }

  return out;
}

function isParkingRecord(textBlock) {
  return /è½¦ä½|è½¦åº“|åœè½¦ä½|è½¦ä½æˆ¿/.test(textBlock);
}

function extractTabularRows(text) {
  const lines = text
    .replace(/\r/g, "")
    .split("\n")
    .map((line) => line.trim())
    .filter(Boolean);

  const rows = [];
  lines.forEach((line) => {
    if (/^æ—¥æœŸ\s*[\t ]*å•ä»·/.test(line)) return;
    if (!line.includes("\t")) return;
    if (isParkingRecord(line)) return;

    const cols = line.split("\t").map((s) => s.trim());
    if (cols.length < 6) return;

    const dateMatch = cols[0].match(/(\d{4})[.\/-å¹´](\d{1,2})(?:[.\/-æœˆ](\d{1,2}))?/);
    const priceMatch = cols[1].match(/(\d+(?:\.\d+)?)(?:\s*å…ƒ)?/);
    if (!dateMatch || !priceMatch) return;

    const y = dateMatch[1].padStart(4, "0");
    const m = String(Number(dateMatch[2])).padStart(2, "0");
    const d = String(Number(dateMatch[3] || "1")).padStart(2, "0");

    const areaMatch = cols[2].match(/(\d+(?:\.\d+)?)/);
    const totalMatch = cols[3].match(/(\d+(?:\.\d+)?)(?:\s*ä¸‡)?/);
    const floorMatch = cols[5].match(/(é«˜æ¥¼å±‚|ä¸­æ¥¼å±‚|ä½Žæ¥¼å±‚|é¡¶å±‚|åº•å±‚|é«˜å±‚|ä¸­å±‚|ä½Žå±‚)(?:[ï¼ˆ(][^ï¼‰)]*[ï¼‰)])?/);

    rows.push({
      date: `${y}-${m}-${d}`,
      price: Number(priceMatch[1]),
      area: areaMatch ? `${areaMatch[1]}ãŽ¡` : "-",
      totalPrice: totalMatch ? `${totalMatch[1]}ä¸‡` : "-",
      direction: cols[4] || "-",
      floor: floorMatch ? floorMatch[0] : cols[5] || "-",
    });
  });

  return rows;
}

function extractHouseDetails(chunk, dateInfo) {
  const columnDetails = extractColumnStyleDetails(chunk);
  if (columnDetails) return columnDetails;

  const areaMatch = chunk.match(/(\d+(?:\.\d+)?)\s*(?:å¹³ç±³|ãŽ¡|mÂ²)/);
  const exactDatePattern = `${dateInfo.year}[.\\/-å¹´]0?${dateInfo.month}(?:[.\\/-æœˆ]0?${dateInfo.day})?(?:æ—¥)?`;
  const dateFollowedPriceRegex = new RegExp(`${exactDatePattern}\\s*(\\d+(?:\\.\\d+)?)\\s*ä¸‡`);
  const dateInTextRegex = new RegExp(
    exactDatePattern
  );
  const chunkAfterDate = chunk.replace(dateInTextRegex, " ");
  const dateFollowedPriceMatch = chunk.match(dateFollowedPriceRegex);
  const totalPriceMatch =
    dateFollowedPriceMatch ||
    chunkAfterDate.match(/æˆäº¤æ€»ä»·\s*(\d+(?:\.\d+)?)\s*ä¸‡/) ||
    chunkAfterDate.match(/æ€»ä»·\s*(\d+(?:\.\d+)?)\s*ä¸‡/) ||
    chunkAfterDate.match(/(\d+(?:\.\d+)?)\s*ä¸‡/);
  const directionMatch = chunk.match(/(ä¸œå—|ä¸œåŒ—|è¥¿å—|è¥¿åŒ—|ä¸œ|å—|è¥¿|åŒ—)(?:\s+(ä¸œå—|ä¸œåŒ—|è¥¿å—|è¥¿åŒ—|ä¸œ|å—|è¥¿|åŒ—))?/);
  const floorMatch = chunk.match(/(é«˜æ¥¼å±‚|ä¸­æ¥¼å±‚|ä½Žæ¥¼å±‚|é¡¶å±‚|åº•å±‚|é«˜å±‚|ä¸­å±‚|ä½Žå±‚)(?:[ï¼ˆ(][^ï¼‰)]*[ï¼‰)])?/);

  return {
    area: areaMatch ? `${areaMatch[1]}ãŽ¡` : "-",
    totalPrice: totalPriceMatch ? `${totalPriceMatch[1]}ä¸‡` : "-",
    direction: directionMatch ? `${directionMatch[1]}${directionMatch[2] ? ` ${directionMatch[2]}` : ""}` : "-",
    floor: floorMatch ? floorMatch[0] : "-",
  };
}

function extractColumnStyleDetails(chunk) {
  const cols = chunk
    .replace(/\r/g, "")
    .split(/\t+/)
    .map((s) => s.trim())
    .filter(Boolean);

  if (cols.length < 5) return null;

  const areaRaw = cols[2] || "";
  const totalRaw = cols[3] || "";
  const directionRaw = cols[4] || "";
  const floorRaw = cols[5] || "";

  const areaMatch = areaRaw.match(/(\d+(?:\.\d+)?)/);
  const totalMatch = totalRaw.match(/(\d+(?:\.\d+)?)\s*ä¸‡/);
  const floorMatch = floorRaw.match(/(é«˜æ¥¼å±‚|ä¸­æ¥¼å±‚|ä½Žæ¥¼å±‚|é¡¶å±‚|åº•å±‚|é«˜å±‚|ä¸­å±‚|ä½Žå±‚)(?:[ï¼ˆ(][^ï¼‰)]*[ï¼‰)])?/);

  return {
    area: areaMatch ? `${areaMatch[1]}ãŽ¡` : "-",
    totalPrice: totalMatch ? `${totalMatch[1]}ä¸‡` : "-",
    direction: directionRaw || "-",
    floor: floorMatch ? floorMatch[0] : floorRaw || "-",
  };
}

function render() {
  if (!parsedData.length) return;

  const startYear = Number(startYearSlider.value);
  startYearLabel.textContent = String(startYear);

  const data = parsedData.filter((p) => Number(p.date.slice(0, 4)) >= startYear);
  if (data.length < 2) return;

  const first = data[0];
  const last = data[data.length - 1];
  const peak = data.reduce((prev, cur) => (cur.price > prev.price ? cur : prev), data[0]);

  startPriceEl.textContent = `${formatCurrency(peak.price)}/ãŽ¡ï¼ˆ${formatYearMonth(peak.date)}ï¼‰`;
  startPriceEl.style.color = "#d43b3b";
  latestPriceEl.textContent = `${formatCurrency(last.price)}/ãŽ¡ï¼ˆ${formatYearMonth(last.date)}ï¼‰`;

  const drawdown = ((last.price - peak.price) / peak.price) * 100;
  totalChangeEl.textContent = `${drawdown.toFixed(2)}%`;
  totalChangeEl.style.color = drawdown < 0 ? "#8f2121" : "#1f6f5f";

  renderChart(data);
  renderTable([...data].reverse());
}

function renderChart(data) {
  const pad = { top: 24, right: 30, bottom: 36, left: 72 };
  const width = 900;
  const height = 380;
  const innerW = width - pad.left - pad.right;
  const innerH = height - pad.top - pad.bottom;

  const prices = data.map((d) => d.price);
  const min = Math.min(...prices) * 0.985;
  const max = Math.max(...prices) * 1.015;
  const plotDates = buildPlotDates(data);
  const dates = data.map((d) => new Date(d.date));
  const startYear = dates[0].getFullYear();
  const endYear = dates[dates.length - 1].getFullYear();
  // Use full-year domain for consistent year spacing across different compounds.
  const minTime = new Date(`${startYear}-01-01T00:00:00`).getTime();
  const maxTime = new Date(`${endYear + 1}-01-01T00:00:00`).getTime();
  const x = (dateValue) => {
    const t = dateValue.getTime();
    const ratio = (t - minTime) / (maxTime - minTime || 1);
    return pad.left + ratio * innerW;
  };
  const y = (price) => pad.top + ((max - price) / (max - min || 1)) * innerH;

  const points = data.map((d, idx) => ({
    idx,
    x: x(plotDates[idx]),
    y: y(d.price),
    row: d,
  }));
  const path = points.map((p, i) => `${i === 0 ? "M" : "L"}${p.x.toFixed(2)},${p.y.toFixed(2)}`).join(" ");

  const yTicks = 5;
  const grid = Array.from({ length: yTicks + 1 }, (_, i) => {
    const p = min + ((max - min) * i) / yTicks;
    const py = y(p);
    return `
      <line class="grid-line" x1="${pad.left}" y1="${py}" x2="${width - pad.right}" y2="${py}" />
      <text x="10" y="${py + 4}" fill="#637581" font-size="12">${shortCurrency(p)}</text>
    `;
  }).join("");

  const maxPrice = Math.max(...data.map((d) => d.price));
  const minPrice = Math.min(...data.map((d) => d.price));
  const maxPoints = points.filter((p) => p.row.price === maxPrice);
  const minPoints = points.filter((p) => p.row.price === minPrice);
  const dots = points
    .map((point) => {
      const isHighest = point.row.price === maxPrice;
      const isLowest = point.row.price === minPrice;
      const classes = `data-point${isHighest ? " highest-point" : ""}${isLowest ? " lowest-point" : ""}`;
      return `<circle
        class="${classes}"
        cx="${point.x}"
        cy="${point.y}"
        r="3"
        data-date="${encodeForAttr(point.row.date)}"
        data-price="${encodeForAttr(`${formatCurrency(point.row.price)}/ãŽ¡`)}"
        data-area="${encodeForAttr(point.row.area || "-")}"
        data-total="${encodeForAttr(point.row.totalPrice || "-")}"
        data-direction="${encodeForAttr(point.row.direction || "-")}"
        data-floor="${encodeForAttr(point.row.floor || "-")}"
        data-index="${point.idx ?? ""}"
      />`;
    })
    .join("");

  const extremePoints = [...maxPoints, ...minPoints.filter((p) => p.row.price !== maxPrice)];
  const extremeOverlays = extremePoints
    .map((point) => {
      const isHighest = point.row.price === maxPrice;
      const className = isHighest ? "extreme-point max-overlay" : "extreme-point min-overlay";
      return `<circle class="${className}" cx="${point.x}" cy="${point.y}" r="${isHighest ? 4.5 : 5}" />`;
    })
    .join("");

  const extremeLabels = extremePoints
    .map((point) => {
      const isHighest = point.row.price === maxPrice;
      const labelClass = isHighest ? "price-label highest-label" : "price-label lowest-label";
      const labelX = point.x + 18;
      const labelY = point.y > height - 34 ? point.y - 10 : point.y + 4;
      return `<text class="${labelClass}" x="${labelX}" y="${labelY}">${shortCurrency(point.row.price)}</text>`;
    })
    .join("");

  const tickMap = new Map();
  for (let year = startYear; year <= endYear; year += 1) {
    const jan1Time = new Date(`${year}-01-01`).getTime();
    tickMap.set(year, jan1Time);
  }

  const xTicks = [...tickMap.entries()]
    .map(([year, time]) => {
      const px = x(new Date(time));
      return `
        <line class="axis" x1="${px}" y1="${height - pad.bottom}" x2="${px}" y2="${height - pad.bottom + 5}" />
        <text x="${px}" y="${height - 10}" text-anchor="middle" fill="#637581" font-size="12">${year}</text>
      `;
    })
    .join("");

  chart.innerHTML = `
    ${grid}
    <line class="axis" x1="${pad.left}" y1="${height - pad.bottom}" x2="${width - pad.right}" y2="${height - pad.bottom}" />
    <line class="axis" x1="${pad.left}" y1="${pad.top}" x2="${pad.left}" y2="${height - pad.bottom}" />
    ${xTicks}
    <path id="trend-path" class="path" d="${path}" />
    ${dots}
    ${extremeOverlays}
    ${extremeLabels}
    <g id="coaster-cart" class="coaster-cart" transform="translate(${points[0].x} ${points[0].y}) rotate(0)">
      <path class="coaster-body" d="M -34 8 L -30 -10 L 18 -10 Q 32 -9 34 1 L 30 8 Z"></path>
      <rect class="coaster-bar" x="-22" y="-2" width="40" height="4" rx="2"></rect>
      <circle class="coaster-wheel" cx="-18" cy="14" r="5"></circle>
      <circle class="coaster-wheel" cx="18" cy="14" r="5"></circle>
      <g class="cat-rider" transform="translate(0,-18)">
        <text class="cat-emoji" x="0" y="-1.2">ðŸ˜»</text>
      </g>
    </g>
    <g id="fireworks-layer"></g>
    <text x="${width - 230}" y="${height - 22}" fill="#637581" font-size="12">${data[0].date.slice(0, 7)} è‡³ ${data[data.length - 1].date.slice(0, 7)}</text>
  `;
  bindChartTooltip(points);
  startCoasterAnimation(points, maxPrice);
}

function buildPlotDates(rows) {
  const baseDates = rows.map((row) => new Date(`${row.date}T12:00:00`));
  const groups = new Map();

  rows.forEach((row, idx) => {
    const arr = groups.get(row.date) || [];
    arr.push(idx);
    groups.set(row.date, arr);
  });

  const stepMinutes = 90;
  groups.forEach((indexes) => {
    if (indexes.length < 2) return;
    const center = (indexes.length - 1) / 2;
    indexes.forEach((dataIdx, pos) => {
      const offsetMinutes = (pos - center) * stepMinutes;
      baseDates[dataIdx] = new Date(baseDates[dataIdx].getTime() + offsetMinutes * 60 * 1000);
    });
  });

  return baseDates;
}

function renderTable(rows) {
  dataBody.innerHTML = rows
    .map((row) => {
      return `
        <tr>
          <td>${row.date}</td>
          <td>${formatCurrency(row.price)}/ãŽ¡</td>
          <td>${row.area || "-"}</td>
          <td>${row.totalPrice || "-"}</td>
          <td>${row.direction || "-"}</td>
          <td>${row.floor || "-"}</td>
        </tr>
      `;
    })
    .join("");
}

function formatCurrency(value) {
  return new Intl.NumberFormat("zh-CN", {
    style: "currency",
    currency: "CNY",
    maximumFractionDigits: 0,
  }).format(value);
}

function shortCurrency(value) {
  const rounded = Math.round(value);
  return `${(rounded / 10000).toFixed(1)}ä¸‡`;
}

function formatYearMonth(dateText) {
  const match = String(dateText || "").match(/^(\d{4})-(\d{2})/);
  if (!match) return "-";
  return `${match[1]}.${match[2]}`;
}

function encodeForAttr(value) {
  return encodeURIComponent(value);
}

function bindChartTooltip(points) {
  const pointEls = chart.querySelectorAll(".data-point");
  chart.onmouseleave = hideChartTooltip;
  chart.onmousemove = (event) => {
    if (!points.length) return;
    const svgX = getSvgXFromMouse(event);
    const nearestIndex = getNearestPointIndex(points, svgX);
    const nearestEl = chart.querySelector(`.data-point[data-index="${nearestIndex}"]`);
    if (!nearestEl) return;
    showChartTooltip(nearestEl);
    setActivePoint(nearestIndex);
  };

  pointEls.forEach((point) => {
    point.addEventListener("mouseenter", () => showChartTooltip(point));
    point.addEventListener("mousemove", () => showChartTooltip(point));
    point.addEventListener("click", () => showChartTooltip(point));
    point.addEventListener("mouseenter", () => setActivePoint(Number(point.dataset.index || -1)));
  });
}

function showChartTooltip(point) {
  if (!chartTooltip || !chartPanel) return;

  const date = decodeURIComponent(point.dataset.date || "-");
  const price = decodeURIComponent(point.dataset.price || "-");
  const area = decodeURIComponent(point.dataset.area || "-");
  const total = decodeURIComponent(point.dataset.total || "-");
  const direction = decodeURIComponent(point.dataset.direction || "-");
  const floor = decodeURIComponent(point.dataset.floor || "-");

  chartTooltip.innerHTML = `
    <div class="title">${date}</div>
    <div>å•ä»·ï¼š${price}</div>
    <div>é¢ç§¯ï¼š${area}</div>
    <div>æ€»ä»·ï¼š${total}</div>
    <div>æœå‘ï¼š${direction}</div>
    <div>æ¥¼å±‚ï¼š${floor}</div>
  `;
  chartTooltip.style.display = "block";

  const svgWidth = 900;
  const svgHeight = 380;
  const cx = Number(point.getAttribute("cx"));
  const cy = Number(point.getAttribute("cy"));
  const chartRect = chart.getBoundingClientRect();
  const panelRect = chartPanel.getBoundingClientRect();
  const px = chartRect.left - panelRect.left + (cx / svgWidth) * chartRect.width;
  const py = chartRect.top - panelRect.top + (cy / svgHeight) * chartRect.height;

  let left = px + 12;
  let top = py - 10;
  const tipRect = chartTooltip.getBoundingClientRect();
  const maxLeft = chartPanel.clientWidth - tipRect.width - 8;
  if (left > maxLeft) left = Math.max(8, px - tipRect.width - 12);
  if (top - tipRect.height < 4) top = py + 12;

  chartTooltip.style.left = `${left}px`;
  chartTooltip.style.top = `${top}px`;
}

function hideChartTooltip() {
  if (!chartTooltip) return;
  chartTooltip.style.display = "none";
  clearActivePoint();
}

function getSvgXFromMouse(event) {
  const rect = chart.getBoundingClientRect();
  const ratioX = (event.clientX - rect.left) / rect.width;
  return Math.max(0, Math.min(900, ratioX * 900));
}

function getNearestPointIndex(points, svgX) {
  let nearestIndex = 0;
  let nearestDelta = Math.abs(points[0].x - svgX);
  for (let i = 1; i < points.length; i += 1) {
    const delta = Math.abs(points[i].x - svgX);
    if (delta < nearestDelta) {
      nearestDelta = delta;
      nearestIndex = i;
    }
  }
  return nearestIndex;
}

function setActivePoint(index) {
  if (activePointIndex === index) return;
  clearActivePoint();
  const el = chart.querySelector(`.data-point[data-index="${index}"]`);
  if (!el) return;
  el.classList.add("active-point");
  activePointIndex = index;
}

function clearActivePoint() {
  if (activePointIndex < 0) return;
  const prevEl = chart.querySelector(`.data-point[data-index="${activePointIndex}"]`);
  if (prevEl) prevEl.classList.remove("active-point");
  activePointIndex = -1;
}

function startCoasterAnimation(points, maxPrice) {
  if (coasterFrameId) cancelAnimationFrame(coasterFrameId);
  activeFireworks = [];

  const pathEl = chart.querySelector("#trend-path");
  const cart = chart.querySelector("#coaster-cart");
  const fireworksLayer = chart.querySelector("#fireworks-layer");
  if (!pathEl || !cart || !fireworksLayer) return;

  const total = pathEl.getTotalLength();
  const speed = 1.4;
  const peakPoints = points.filter((p) => p.row.price === maxPrice);
  let lastFireworkAt = 0;

  const animate = () => {
    coasterDistance = (coasterDistance + speed) % total;
    const p = pathEl.getPointAtLength(coasterDistance);
    const p2 = pathEl.getPointAtLength((coasterDistance + 1) % total);
    const catEmoji = cart.querySelector(".cat-emoji");
    if (p2.y > p.y) {
      cart.classList.add("downhill");
      if (catEmoji) catEmoji.textContent = "ðŸ™€";
    } else {
      cart.classList.remove("downhill");
      if (catEmoji) catEmoji.textContent = "ðŸ˜»";
    }
    const angle = (Math.atan2(p2.y - p.y, p2.x - p.x) * 180) / Math.PI;
    cart.setAttribute("transform", `translate(${p.x} ${p.y}) rotate(${angle})`);
    maybeTriggerFirework(p, peakPoints, fireworksLayer, () => {
      const now = performance.now();
      if (now - lastFireworkAt < 700) return false;
      lastFireworkAt = now;
      return true;
    });
    updateFireworks(fireworksLayer);
    coasterFrameId = requestAnimationFrame(animate);
  };

  animate();
}

function maybeTriggerFirework(cartPoint, peakPoints, layer, cooldownCheck) {
  const triggerDistance = 16;
  for (const peak of peakPoints) {
    const dx = cartPoint.x - peak.x;
    const dy = cartPoint.y - peak.y;
    if (Math.hypot(dx, dy) <= triggerDistance) {
      if (!cooldownCheck()) return;
      spawnFirework(layer, peak.x, peak.y);
      spawnFirework(layer, peak.x + (Math.random() * 14 - 7), peak.y - (12 + Math.random() * 14));
      return;
    }
  }
}

function spawnFirework(layer, x, y) {
  const colors = ["#ff4d4f", "#ffd666", "#73d13d", "#40a9ff", "#9254de", "#ffa940"];
  const count = 42;
  const ns = "http://www.w3.org/2000/svg";

  const core = document.createElementNS(ns, "circle");
  core.setAttribute("cx", String(x));
  core.setAttribute("cy", String(y));
  core.setAttribute("r", "8");
  core.setAttribute("fill", "#fff1a8");
  core.setAttribute("opacity", "0.9");
  layer.appendChild(core);
  activeFireworks.push({
    el: core,
    x,
    y,
    vx: 0,
    vy: 0,
    life: 0,
    maxLife: 14,
    core: true,
  });

  for (let i = 0; i < count; i += 1) {
    const angle = (Math.PI * 2 * i) / count + Math.random() * 0.2;
    const speed = 3.2 + Math.random() * 3.4;
    const particle = document.createElementNS(ns, "circle");
    particle.setAttribute("cx", String(x));
    particle.setAttribute("cy", String(y));
    particle.setAttribute("r", String(3.8 + Math.random() * 2.4));
    particle.setAttribute("fill", colors[i % colors.length]);
    particle.setAttribute("stroke", "#ffffff");
    particle.setAttribute("stroke-width", "0.7");
    layer.appendChild(particle);
    activeFireworks.push({
      el: particle,
      x,
      y,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life: 0,
      maxLife: 54 + Math.random() * 30,
      core: false,
    });
  }
}

function updateFireworks(layer) {
  const next = [];
  for (const p of activeFireworks) {
    p.life += 1;
    if (!p.core) {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.055;
      p.vx *= 0.991;
    }
    const alpha = Math.max(0, 1 - p.life / p.maxLife);
    p.el.setAttribute("cx", String(p.x));
    p.el.setAttribute("cy", String(p.y));
    if (p.core) {
      const rr = Math.max(0.6, 8 - p.life * 0.5);
      p.el.setAttribute("r", rr.toFixed(2));
    }
    p.el.setAttribute("opacity", alpha.toFixed(3));
    if (p.life < p.maxLife) {
      next.push(p);
    } else {
      layer.removeChild(p.el);
    }
  }
  activeFireworks = next;
}
